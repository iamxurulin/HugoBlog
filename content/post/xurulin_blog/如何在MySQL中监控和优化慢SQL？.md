---
title: "如何在MySQL中监控和优化慢SQL？"
date: 2026-01-20 18:04:18
categories:
  - 八股
tags:
  - 数据库
draft: false
---

在MySQL中监控和优化慢SQL的核心是**开启MySQL的慢查询日志**，慢查询日志会把执行时间**超过设定阈值的SQL语句**自动记录下来，通过日志的分析与执行计划的校验实现SQL性能的精准优化。

主要步骤：

1.开启慢查询日志，设置合理的时间阈值，线上环境通常将阈值设定为1~2秒，确保执行耗时较长的慢SQL能够被精准捕获。

2.定期对慢查询日志进行分析，用MySQL自带的分析工具`mysqldumpslow`或Percona
 Toolkit里的`pt-query-digest`工具，对日志中的SQL进行汇总统计，定位高频出现的慢SQL。

3.对高频的慢SQL执行EXPLAIN命令分析其执行计划，检查是否走索引、扫描数据行数、是否存在文件排序等问题，再针对分析结果开展针对性优化。

### 几个常见的慢SQL优化方向

1.查看EXPLAIN 结果的type字段，如果值为ALL，说明当前SQL是全表扫描；如果key列为空，就说明该SQL未使用索引，需优化索引配置。

2.如果SELECT查询的字段没有包含在索引里，会触发回表查询，可以通过构建覆盖索引进行优化，把查询所需的字段都放进索引。

3.查看EXPLAIN结果的Extra字段，如果是Using filesort，说明数据库执行了手动排序；如果是Using temporary，说明用了临时表；这两种情况都可以通过为对应字段添加索引来避免。

4.避免用SELECT *查询所有字段，可以明确指定所需的字段；可以通过添加LIMIT子句控制单次查询返回的条数，从而减少数据处理压力。

