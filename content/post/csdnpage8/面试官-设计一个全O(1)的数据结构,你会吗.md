---
title: "é¢è¯•å®˜:è®¾è®¡ä¸€ä¸ªå…¨O(1)çš„æ•°æ®ç»“æ„,ä½ ä¼šå—?"
date: 2025-10-26 21:23:06
categories:
- ç®—æ³•
tags:
- leetcode
draft: false
---

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/c8db4a4e02784fc283a26681a0875f09.png#pic_center)
è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ„æ€çš„æ•°æ®ç»“æ„è®¾è®¡é¢˜ï¼Œè¦æ±‚æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªæ”¯æŒæ‰€æœ‰æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½å¿…é¡»æ˜¯ O(1)çš„æ•°æ®ç»“æ„ã€‚
### ä»£ç é€»è¾‘

è¿™é“é¢˜çš„éš¾ç‚¹åœ¨äº:

å¦‚ä½•åœ¨ O(1) æ—¶é—´å†…æ—¢èƒ½ä¿®æ”¹è®¡æ•°,åˆèƒ½å¿«é€Ÿæ‰¾åˆ°æœ€å¤§/æœ€å°å€¼?

å¦‚æœåªç”¨ HashMap å­˜å‚¨è®¡æ•°,ä¿®æ”¹å¾ˆå¿«,ä½†æ‰¾æœ€å¤§/æœ€å°å€¼éœ€è¦éå†,æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚

å¦‚æœç”¨æ’åºç»“æ„,æŸ¥æ‰¾æœ€å¤§/æœ€å°å€¼å¾ˆå¿«,ä½†æ’å…¥åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦åˆæ— æ³•ä¿è¯ O(1)ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªéš¾é¢˜ï¼Œæˆ‘çš„æ€è·¯æ˜¯ç”¨ä¸€ä¸ª**åŒå‘é“¾è¡¨**æŒ‰è®¡æ•°å¤§å°æœ‰åºåœ°å­˜å‚¨æ‰€æœ‰"æ¡¶"(Bucket)ï¼Œå…¶ä¸­æ¯ä¸ªæ¡¶ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„è®¡æ•°å€¼,åŒ…å«æ‰€æœ‰è¯¥è®¡æ•°çš„ keyï¼Œå†ç”¨ä¸€ä¸ª **HashMap** è®°å½•æ¯ä¸ª key å½“å‰æ‰€åœ¨çš„æ¡¶ã€‚
#### 1. Bucket(æ¡¶)ç»“æ„

```java
class Bucket {
    public HashSet<String> set;  // å­˜å‚¨æ‰€æœ‰è¯¥è®¡æ•°çš„ key
    public int cnt;               // è®¡æ•°å€¼
    public Bucket last;           // å‰é©±èŠ‚ç‚¹
    public Bucket next;           // åç»§èŠ‚ç‚¹
    
    public Bucket(String s, int c) {
        set = new HashSet<>();
        set.add(s);
        cnt = c;
    }
}
```
#### 2. inc(key) - å¢åŠ è®¡æ•°

å¦‚æœkey ä¸å­˜åœ¨ï¼Œéœ€è¦åˆ›å»ºè®¡æ•°ä¸º 1 çš„æ¡¶ï¼›å¦‚æœ head.next çš„è®¡æ•°æ­£å¥½æ˜¯ 1,ç›´æ¥åŠ å…¥è¯¥æ¡¶ï¼Œå¦åˆ™,åœ¨ head ååˆ›å»ºæ–°æ¡¶ã€‚

å¦‚æœkey å·²å­˜åœ¨ï¼Œä»å½“å‰æ¡¶ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªè®¡æ•°çš„æ¡¶ï¼Œå¦‚æœ next çš„è®¡æ•°æ­£å¥½æ˜¯ cnt+1,ç›´æ¥åŠ å…¥ï¼Œå¦åˆ™,åˆ›å»ºæ–°æ¡¶æ’å…¥å½“å‰æ¡¶åé¢ã€‚

```java
if (!map.containsKey(key)) {
    if (head.next.cnt == 1) {
        map.put(key, head.next);
        head.next.set.add(key);
    } else {
        Bucket newBucket = new Bucket(key, 1);
        map.put(key, newBucket);
        insert(head, newBucket);
    }
}else {
    Bucket bucket = map.get(key);
    if (bucket.next.cnt == bucket.cnt + 1) {
        map.put(key, bucket.next);
        bucket.next.set.add(key);
    } else {
        Bucket newBucket = new Bucket(key, bucket.cnt + 1);
        map.put(key, newBucket);
        insert(bucket, newBucket);
    }
    bucket.set.remove(key);
    if (bucket.set.isEmpty()) {
        remove(bucket);  // å¦‚æœæ¡¶ç©ºäº†,åˆ é™¤è¯¥æ¡¶
    }
}
```
#### 3. dec(key) - å‡å°‘è®¡æ•°

å¦‚æœè®¡æ•°å‡åˆ° 0,éœ€è¦ä» map ä¸­åˆ é™¤è¯¥ keyï¼Œå¦åˆ™,å‘å‰ç§»åŠ¨åˆ°è®¡æ•°å‡ 1 çš„æ¡¶ã€‚

```java
public void dec(String key) {
    Bucket bucket = map.get(key);
    if (bucket.cnt == 1) {
        map.remove(key);  // è®¡æ•°ä¸º0,å½»åº•åˆ é™¤
    } else {
        if (bucket.last.cnt == bucket.cnt - 1) {
            map.put(key, bucket.last);
            bucket.last.set.add(key);
        } else {
            Bucket newBucket = new Bucket(key, bucket.cnt - 1);
            map.put(key, newBucket);
            insert(bucket.last, newBucket);
        }
    }
    bucket.set.remove(key);
    if (bucket.set.isEmpty()) {
        remove(bucket);
    }
}
```

#### 4. getMaxKey() å’Œ getMinKey()

```java
public String getMaxKey() {
    return tail.last.set.iterator().next();
}

public String getMinKey() {
    return head.next.set.iterator().next();
}
```

#### 5.insert() - åœ¨æŒ‡å®šä½ç½®æ’å…¥æ¡¶

```java
private void insert(Bucket cur, Bucket pos) {
    cur.next.last = pos;
    pos.next = cur.next;
    cur.next = pos;
    pos.last = cur;
}
```
#### 6.remove() - åˆ é™¤æ¡¶

```java
private void remove(Bucket cur) {
    cur.last.next = cur.next;
    cur.next.last = cur.last;
}
```

**å®Œæ•´ä»£ç **

```java
class AllOne {
		class Bucket {
			public HashSet<String> set;
			public int cnt;
			public Bucket last;
			public Bucket next;

			public Bucket(String s, int c) {
				set = new HashSet<>();
				set.add(s);
				cnt = c;
			}
		}

		private void insert(Bucket cur, Bucket pos) {
			cur.next.last = pos;
			pos.next = cur.next;
			cur.next = pos;
			pos.last = cur;
		}


		private void remove(Bucket cur) {
			cur.last.next = cur.next;
			cur.next.last = cur.last;
		}

		Bucket head;                      // å“¨å…µå¤´èŠ‚ç‚¹(cnt=0)
		Bucket tail;                      // å“¨å…µå°¾èŠ‚ç‚¹(cnt=MAX)
		HashMap<String, Bucket> map;      // key -> æ‰€åœ¨æ¡¶çš„æ˜ å°„

		public AllOne() {
			head = new Bucket("",0);
			tail = new Bucket("",Integer.MAX_VALUE);
			head.next = tail;
			tail.last = head;
			map = new HashMap<>();
		}

		public void inc(String key){
			if(!map.containsKey(key)){
				if(head.next.cnt==1){
					map.put(key,head.next);
					head.next.set.add(key);
				}else {
					Bucket newBucket = new Bucket(key,1);
					map.put(key,newBucket);
					insert(head,newBucket);
				}
			}else{
				Bucket bucket = map.get(key);
				if(bucket.next.cnt==bucket.cnt+1){
					map.put(key,bucket.next);
					bucket.next.set.add(key);
				}else{
					Bucket newBucket = new Bucket(key, bucket.cnt+1);
					map.put(key,newBucket);
					insert(bucket,newBucket);
				}
				bucket.set.remove(key);
				if(bucket.set.isEmpty()){
					remove(bucket);// å¦‚æœæ¡¶ç©ºäº†,åˆ é™¤è¯¥æ¡¶
				}
			}
		}

		public void dec(String key){
			Bucket bucket = map.get(key);
			if(bucket.cnt==1){
				map.remove(key);// è®¡æ•°ä¸º0,å½»åº•åˆ é™¤
			}else{
				if(bucket.last.cnt==bucket.cnt-1){
					map.put(key,bucket.last);
					bucket.last.set.add(key);
				}else{
					Bucket newBucket = new Bucket(key,bucket.cnt-1);
					map.put(key,newBucket);
					insert(bucket.last,newBucket);
				}
			}
			bucket.set.remove(key);
			if(bucket.set.isEmpty()){
				remove(bucket);
			}
		}

		public String getMaxKey(){
			return tail.last.set.iterator().next();
		}

		public String getMinKey(){
			return head.next.set.iterator().next();
		}
	}
```

---

**å¦‚æœè§‰å¾—æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµå…³æ³¨!** ğŸŒŸ

